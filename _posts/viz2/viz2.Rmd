---
title: "Visualization 2"
description: |
  A short description of the post.
author:
  - name: Joanna Wright
    url: https://github.com/jhwrigh23
date: 03-09-2020
output:
  distill::distill_article:
    self_contained: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

```

```{r}

library(tidyverse)
library(rio)
library(here)
library(janitor)
library(gt)
library(ggrepel)

```


```{r loading-the-data}

d <- import(here("data", "ka_2018-19_lookback_report.xlsx")) %>%
  clean_names()

counties <- map_data("county")
or_county <- subset(counties, region == "oregon")

```

```{r cleaning-the-data}

d_tidy <- d %>%
  rename(county = oregon_kindergarten_assessment,
         district_id = x2,
         district = x3,
         inst_id = x4,
         inst_name = x5,
         inst_type = x6,
         stu_grp_type = x7,
         stu_grp = x8,
         avg_self_reg = x9) %>%
  select(c(1:9))

d_tidy <- d_tidy %>%
  filter(avg_self_reg != "*")

d_tidy = d_tidy[-1,]

str(d_tidy)
d_tidy$avg_self_reg = as.numeric(d_tidy$avg_self_reg)

```

The purpose of Plot 2 is to explore the degree to which self-regulation scores vary by race in Oregon. Because the student group variable included both racial and gender categories, I filtered to keep only race categories, and in plotting reordered them to show highest to lowest average self-regulation scores.  

```{r viz2}

d2 <- d_tidy %>%
  filter(stu_grp == "Asian" |
           stu_grp == "White" |
           stu_grp == "Multi-Racial" |
           stu_grp == "Native Hawaiian/Pacific Islander" |
           stu_grp == "Hispanic/Latino" |
           stu_grp == "Black/African American" |
           stu_grp == "American Indian/Alaska Native")

d2 %>%
  group_by(stu_grp) %>%
  summarise(avg_self_reg_race = mean(avg_self_reg)) %>%
  ggplot(aes(fct_reorder(stu_grp, avg_self_reg_race), avg_self_reg_race)) +
  geom_point() +
  coord_flip() + 
  labs(title = "Average self-regulation by race",
       x = NULL,
       y = "Self-regulation score")

```

Rather than just having an overall average score by race, it may be more informative to see distributions for each race, as the average can obscure information such as the range.  

```{r viz2-alternative}

d2 %>%
ggplot(aes(avg_self_reg, fct_reorder(stu_grp, avg_self_reg))) +
  ggridges::geom_density_ridges(color = "white", 
                                fill = "cornflowerblue", 
                                alpha = 0.8) + 
  theme_minimal(base_size = 10) + 
  scale_x_continuous("Self Regulation Scores") +
  theme(panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_line(color = "gray80")) +
  labs(title = "Self-Regulation Scores by Race",
       x = NULL,
       y = NULL)
  
```

Or, another way to visualize the distributions: 

```{r viz2-alternative}

d2 %>%
  ggplot(aes(avg_self_reg, fct_reorder(stu_grp, avg_self_reg))) +
  geom_violin(fill = "cornflowerblue")

```

To put these numbers in context, it is important to know that some student groups are represented much more strongly than others. 

```{r}

d2 %>%
  group_by(stu_grp) %>%
  count()

d2 %>%
  group_by(county) %>%
  count(stu_grp)
             
```

Let's look at difference in self-regulation scores between the largest student groups represented. 

```{r}

d2 %>%
  filter(stu_grp == "White" |
           stu_grp == "Hispanic/Latino") %>%
  group_by(stu_grp, county) %>%
  summarise(avg_self_reg_race = mean(avg_self_reg)) %>%
  pivot_wider(
    names_from = stu_grp,
    values_from = avg_self_reg_race
  ) %>%
  mutate(white_hisp_diff = c(White - `Hispanic/Latino`)) %>%
  ggplot(aes(county, white_hisp_diff)) +
  geom_point() +
  coord_flip()

```

```{r}

d2 %>%
  filter(stu_grp == "White" |
           stu_grp == "Hispanic/Latino") %>%
  group_by(stu_grp, county) %>%
  summarise(avg_self_reg_race = mean(avg_self_reg)) %>%
  pivot_wider(
    names_from = stu_grp,
    values_from = avg_self_reg_race
  ) %>%
  mutate(white_hisp_diff = c(White - `Hispanic/Latino`)) %>%
  filter(white_hisp_diff != "NA") %>%
  ggplot(aes(fct_reorder(county, white_hisp_diff), white_hisp_diff)) +
  geom_point(col = "darkred") +
  coord_flip() + 
  gghighlight::gghighlight(white_hisp_diff < -.25 |
                             white_hisp_diff > .25,
                           unhighlighted_colour = alpha("steelblue", 0.4)) + 
  geom_point(col = "darkred", size = 2.5) + 
  labs(title = "Differences Self-Regulation Scores by Race in Oregon",
       subtitle = "Disparities in scores between White and Hispanic/Latino students",
       x = NULL,
       y = "Difference in scores")
  
```

